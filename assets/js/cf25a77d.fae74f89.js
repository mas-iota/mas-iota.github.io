(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{158:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return l})),n.d(t,"default",(function(){return u}));var r=n(3),a=n(8),i=(n(0),n(176)),o={id:"using-single-sign-on-sso",title:"Using Single Sign On (SSO)",sidebar_label:"Using Single Sign On (SSO)",description:null,keywords:["buildfire","input","inputAPI","API"],slug:"/using-single-sign-on-sso"},s={unversionedId:"using-single-sign-on-sso",id:"using-single-sign-on-sso",isDocsHomePage:!1,title:"Using Single Sign On (SSO)",description:"The purpose of this feature is to allow app users to login using Business Partner's (BP) authentication service.",source:"@site/docs/Single-Sign-On-(SSO).md",slug:"/using-single-sign-on-sso",permalink:"/docs/using-single-sign-on-sso",version:"current",sidebar_label:"Using Single Sign On (SSO)",sidebar:"integrations",previous:{title:"Stripe",permalink:"/docs/stripe"},next:{title:"Using OAuth2 Sign In Integration",permalink:"/docs/using-oauth2-sign-in-integration"}},l=[{value:"Authorization procedure",id:"authorization-procedure",children:[]},{value:"After authorization",id:"after-authorization",children:[]},{value:"Forgot/Reset Password",id:"forgotreset-password",children:[]},{value:"WordPress Integrations",id:"wordpress-integrations",children:[]},{value:"Content Type",id:"content-type",children:[]},{value:"Registration Form",id:"registration-form",children:[]}],c={toc:l};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The purpose of this feature is to allow app ",Object(i.b)("em",{parentName:"p"},"users")," to login using Business Partner's (BP) authentication service."),Object(i.b)("p",null,"At a high level, this functionality will allow the user to enter a Username and Password then POST it to their servers and get back a User Access Token. Once you have the access token you then send it to a BuildFire's validation api that the third party api returns a user profile. BuildFire will take that user profile and update records and use a BuildFire access token to use BuildFire resources."),Object(i.b)("h2",{id:"authorization-procedure"},"Authorization procedure"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"}," +--------+                               +---------------+\n |        |--(A)- Authorization Request ->|      BP       |\n |        |                               |   Resource    |\n |        |<-(B)-- Authorization Grant ---|     Owner     |\n |        |                               +---------------+\n |        |\n |        |                               +---------------+\n |        |--(C)-- Authorization Grant --\x3e|      BP       |\n | Client |                               | Authorization |\n |        |<-(D)----- Access Token -------|     Server    |\n |        |                               +---------------+\n |        |\n |        |                               +---------------+\n |        |--(E)----- Access Token ------\x3e|       BP      |\n |        |                               |    Resource   |\n |        |<-(F)--- Protected Resource ---|     Server    |\n +--------+                               +---------------+\n")),Object(i.b)("p",null,"Following oAuth2 standards, BuildFires app uses the password grant type. In this grant type, we send a user's username and password to our business partner (BP). This is a HTTP POST with the body object as follows:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "grant_type": "password",\n  "username": "<USERNAME>",\n  "password": "<PASSWORD>",\n  "client_id": "<CLIENT_ID>",\n  "client_secret": "<CLIENT_SECRET>"\n}\n')),Object(i.b)("p",null,"This is posted to the BP's authentication server. If the username/password is successful, The authentication server responds with a userToken object with the following format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "issued_at": "<EPOCH TIMESTAMP>",\n  "status": "approved",\n  "expires_in": "1799",\n  "token_type": "BearerToken", //only support Bearer Token\n  "access_token": "I6daIgMSiUgYX1K2qgQWPi37ztS6",\n  "client_id": "<client ID>" //keep client id in sync\n}\n')),Object(i.b)("p",null,"If the username/password is unsuccessful, the BP's authentication server will send a HTTP 400 (bad request) (per RFC 6749 section 5.2). Here are the response parameters"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Required"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"error")),Object(i.b)("td",{parentName:"tr",align:null},"yes"),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"invalid_request"),": The request is missing a required parameter, includes an unsupported parameter value (other than grant type), repeats a parameter, includes multiple credentials, utilizes more than one mechanism for authenticating the client, or is otherwise malformed. ",Object(i.b)("inlineCode",{parentName:"td"},"invalid_client")," : Client authentication failed (e.g., unknown client, no client authentication included, or unsupported authentication method). ",Object(i.b)("inlineCode",{parentName:"td"},"unauthorized_client"),": The authenticated client is not authorized to use the password authorization grant type.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"error_description")),Object(i.b)("td",{parentName:"tr",align:null},"no"),Object(i.b)("td",{parentName:"tr",align:null},"Human-readable ASCII ","[USASCII]",' text providing additional information, used to assist the client developer in understanding the error that occurred. Values for the "error_description" parameter MUST NOT include characters outside the set ',Object(i.b)("inlineCode",{parentName:"td"},"%x20-21")," / ",Object(i.b)("inlineCode",{parentName:"td"},"%x23-5B")," / ",Object(i.b)("inlineCode",{parentName:"td"},"%x5D-7E"),".")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"error_uri")),Object(i.b)("td",{parentName:"tr",align:null},"no"),Object(i.b)("td",{parentName:"tr",align:null},'A URI identifying a human-readable web page with information about the error, used to provide the client developer with additional information about the error. Values for the "error_uri" parameter MUST conform to the URI-reference syntax and thus MUST NOT include characters outside the set ',Object(i.b)("inlineCode",{parentName:"td"},"%x21")," / ",Object(i.b)("inlineCode",{parentName:"td"},"%x23-5B")," / ",Object(i.b)("inlineCode",{parentName:"td"},"%x5D-7E"),".")))),Object(i.b)("h2",{id:"after-authorization"},"After authorization"),Object(i.b)("p",null,"When the BuildFire app receives the authorization token. We will then HTTP GET with access token in header (authorization field) to the protected user profile resource and our BP will return the following user fields:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "first_name": String, //firstname is acceptable too\n  "last_name": String, //lastname is acceptable too\n  "email": String,\n  "user_name": String,\n  "display_name": String,\n  "profile_pic": String(URL)\n}\n')),Object(i.b)("p",null,"Here is an example of the HTTP header:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"     GET /resource HTTP/1.1\n     Host: server.example.com\n     Authorization: Bearer mF_9.B5f-4.1JqM\n")),Object(i.b)("p",null,"We will store BP's authorization token with the user (in a SSO object) and issue our own access token to access BuildFire resources. This will allow for backward compatibility. The user will now be able to use the BuildFire app as a login user. In a plugin, you can call buildfire.auth.getCurrentUser() and it will return the SSO object. This will allow the app and any plugins to make API calls to BP's resources. The BP will send back an expires_in field and an issued_at field. Add these together and store these in the kAuth's users table. This field, expired_at, will signify when the token has expired."),Object(i.b)("p",null,"Create a new service in kAuth that runs every 5 seconds. This service will query users whose expired_at field is in the past. For expired tokens, set the access token to null."),Object(i.b)("h2",{id:"forgotreset-password"},"Forgot/Reset Password"),Object(i.b)("p",null,"If the user forget's their password, then they can send a request through the BuildFire app. BuildFire will do a HTTP GET with the username in the querystring of the URL. From there, our BP can send an email to the user detailing how to change the password. An example of this would be :"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"https://www.example.com?email=person@example.com\n")),Object(i.b)("h2",{id:"wordpress-integrations"},"WordPress Integrations"),Object(i.b)("p",null,"SSO is often used in conjunction with Word Press. The plugin WP OAuth Server is often used. The relevant documentation for this plugin is found here:"),Object(i.b)("p",null,Object(i.b)("a",{parentName:"p",href:"https://wp-oauth.com/documentation/grant-types/user-credentials/"},"https://wp-oauth.com/documentation/grant-types/user-credentials/")),Object(i.b)("p",null,"For Wordpress, we recommend using the following route to verify the token:"),Object(i.b)("p",null,"https://<mydomain",">",".com/wp-json/wp/v2/users/me"),Object(i.b)("p",null,"After getting a token from the BP auth, then the user can use the BuildFire webview plugin (",Object(i.b)("a",{parentName:"p",href:"https://github.com/BuildFire/webviewPlugin"},"https://github.com/BuildFire/webviewPlugin"),"). In the route, we expect the URL to be in the following format:"),Object(i.b)("p",null,"https://<",Object(i.b)("a",{parentName:"p",href:"http://www.mydomain.com%5C%3E?access_token=%7B%7BSSO%7D%7D"},"www.mydomain.com\\>?access_token={{SSO}}")),Object(i.b)("p",null,"The plugin will then replace {{SSO}} with the token. The BP site owner should then add a cookie so as the user navigates from page to page, they will not need to re-login."),Object(i.b)("h2",{id:"content-type"},"Content Type"),Object(i.b)("p",null,"SSO supports the following content types for SSO:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("inlineCode",{parentName:"li"},"application/x-www-form-urlencoded")," - For this content type, the body keys and values will be URI encoded and separated by an ampersand (&)."),Object(i.b)("li",{parentName:"ol"},Object(i.b)("inlineCode",{parentName:"li"},"mulipart/form-data")," - For this content type, the body will be separated into fields and passed to token URL.")),Object(i.b)("h2",{id:"registration-form"},"Registration Form"),Object(i.b)("p",null,"If the app owner has page for registration, BuildFire app will open the registration form in iframe.\nTo integrate with BF platform, the registration page should execute javascript code after registration complete to make full integrate with BuildFire app by send a post message to BuildFire app."),Object(i.b)("h4",{id:"response-object"},"response object:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"status")),Object(i.b)("td",{parentName:"tr",align:null},"string"),Object(i.b)("td",{parentName:"tr",align:null},"Has two values ",Object(i.b)("inlineCode",{parentName:"td"},'"success"')," or 'close', if the value ",Object(i.b)("inlineCode",{parentName:"td"},'"success"')," the BF app will close the page and take the username and ",Object(i.b)("inlineCode",{parentName:"td"},"access_token")," to login the user automatically to the app.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"username")),Object(i.b)("td",{parentName:"tr",align:null},"string"),Object(i.b)("td",{parentName:"tr",align:null},"Username created from the registration form.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"access_token")),Object(i.b)("td",{parentName:"tr",align:null},"string"),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"access_token")," returned from the registration form.")))),Object(i.b)("h4",{id:"example"},"Example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-html"},'<!DOCTYPE html>\n<html lang="en">\n  <head>\n    <script>\n      function afterRegister(username, access_token) {\n        var result = {\n          status: "success",\n          user: { username: username, access_token: access_token },\n        };\n        window.parent.postMessage(JSON.stringify(result), "*");\n      }\n\n      function createUser() {\n        //call your register api to create user\n        //on callback call afterRegister with passing the username and access_token\n        afterRegister(username, access_token);\n      }\n    <\/script>\n  </head>\n  <body>\n    <div>\n      <label>First Name</label>\n      <input type="text" name="firstName" />\n    </div>\n    <div>\n      <label>Last Name</label>\n      <input type="text" name="lastName" />\n    </div>\n    <div>\n      <label>Email</label>\n      <input type="text" name="username" />\n    </div>\n    <div>\n      <label>Password</label>\n      <input type="password" name="password" />\n    </div>\n    <div>\n      <button onclick="createUser();">Register</button>\n    </div>\n  </body>\n</html>\n')))}u.isMDXComponent=!0},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=a.a.createContext({}),u=function(e){var t=a.a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return a.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},b=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),b=r,h=p["".concat(o,".").concat(b)]||p[b]||d[b]||i;return n?a.a.createElement(h,s(s({ref:t},c),{},{components:n})):a.a.createElement(h,s({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=b;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var c=2;c<i;c++)o[c]=n[c];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);